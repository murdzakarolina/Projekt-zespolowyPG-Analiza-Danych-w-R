---
title: "Analiza danych w R - projekt zespołowy"
author: "Karolina Murdza, Alicja Hyży, Aleksandra Jakóbiak, Jan Freda"
date: "`r Sys.Date()`"
output:
  rmdformats::material:
    highlight: kate
---

````{r setup, include=FALSE}
## Global options
knitr::opts_chunk$set(cache = TRUE)
library(tidyverse)
library(readr)
library (naniar)

dane <- read.csv("data/Students_Social_Media_Addiction.csv")
````

# Wstęp

Celem projektu jest analiza danych dotyczących uzależnień od social mediów wśród studentów. Dane zawierają wiek, płeć, stopień wykształcenia, narodowość, najczęściej używana platforma, czas snu, zdrowie psychiczne, status związku. Głównym celem jest zbadanie, w jaki sposób korzystanie z mediów społecznościowych wpływa na uczniów:
1.	Wyniki w nauce
2.	Jakość snu

## Pytania badawcze

1.  Jaki jest średni czas jaki studenci spedzają dziennie na używanie social mediów?

2.  Jaka jest najczęściej używana przez studentów platforma?

3.  Jakie są różnice w czasie spędzanym na platformach social media w zależności od płci?

4.  Jaki jest średni czas snu w zależności od średniego czasu spędzanego na platformach social media?

5.  Jakie platformy społecznościowe najczęściej powodują objawy uzależnienia wśród studentów?

6.  Czy poziom wykształcenia wpływa na intensywność używania mediów społecznościowych?

7.  Czy status związku wpływa na czas spędzany w social mediach?

8.  Jaki jest średni czas spędzany w social mediach w zależności od narodowości?

9. Czy istnieją różnice w poziomie uzależnienia w zależności od narodowości studentów?

10. Czy poziom uzależnienia od mediów społecznościowych różni się między studentami płci żeńskiej i męskiej? 

### Opis danych 

Zbiór danych "Students_Social_Media_Addiction.csv" zawiera informacje o `r nrow(dane)` obserwacji i `r ncol(dane)` zmiennych.

Poniżej znajduje się opis najważniejszych zmiennych w zbiorze danych:

- `Age`: Wiek studenta (od 16 do 100 lat)

- `Gender`: Płeć studenta (Mężczyzna/Kobieta) 

- `Academic_level`: Poziom wykształcenia (Średnie/W trakcie studiów/Studia wyższe)

- `Country`: Narodowość studenta

- `Avg_Daily_Usage_Hours`: Średni dzienny czas spędzany na mediach społecznościowych (w godzinach - wartości od 0 do 24)

- `Most_Used_Platform`: Najczęściej używana platforma mediów społecznościowych (Facebook, Instagram, Twitter, TikTok, Snapchat, Inne)

- `Affects_Academic_Performance`: Wpływ na wyniki w nauce (Tak/Nie)

- `Sleep_Hours_Per_Night`: Liczba godzin snu na dobę (od 0 do 24 godzin)

- `Mental_Health_Score`: Wynik zdrowia psychicznego (skala od 1 do 10)

- `Relationship_Status`: Status związku (Singiel/W związku/To skomplikowane)

- `Conflicts_Over_Social_Media`: Konflikty związane z używaniem mediów społecznościowych (skala od 1 do 5)

- `Addicted_Score`: Wynik uzależnienia od mediów społecznościowych (skala od 1 do 10) 

# 1. Porządkowanie i czyszczenie danych

# 1.1 Braki danych

```{r}
procent <- prop_complete_var(dane) *100
```

W danych znajduje się `r procent` % kompletnych wartości.

```{r}
naniar::vis_miss(dane)
```

## 1.2 Wzorzec braków danych

```{r}
library(finalfit)
missing_pattern(dane)
```

```{r}
VIM::aggr(dane, col=c('navyblue','red'), numbers=TRUE, sortVars=TRUE, labels=names(dane), cex.axis=.7, gap=3, ylab=c("Procent braków danych","Wzorzec braków danych"))
```


```{r}
library(ggplot2)
ggplot(data = dane) + 
  geom_miss_point(aes(x = Avg_Daily_Usage_Hours , y = Sleep_Hours_Per_Night))
```


## 1.3 Imputacje metodą hotdeck

```{r}
library(VIM)
Dane_imp <- hotdeck(dane)
naniar::vis_miss(Dane_imp)
```

# 2. Walidacja danych

**Definicja**

> Walidacja danych to proces sprawdzania poprawności, kompletności i spójności danych w celu zapewnienia ich jakości i wiarygodności. Polega na identyfikacji i eliminacji błędów, nieścisłości oraz braków danych, co pozwala na uzyskanie rzetelnych wyników analizy.

## Reguły 

Reguły, które muszą spełnić nasze dane:

1. Wiek studentów mieści się w przedziale <16, 100>
2. Średni czas spędzany na platformach social media mieści się w przedziale <0, 24>
3. Średni czas snu na dobę mieści się w przedziale <0, 24>
4. Wynik zdrowia psychicznego mieści się w przedziale <0,10>
5. Wynik uzależnienia mieści się w przedziale <0,10>
6. Płeć to "Female", "Male" lub "Other"
7. Poziom wykształcenia to "Undergraduate", "Graduate", "High School"
8. Najczęściej używane platfomy to : "Instagram", "Facebook", "TikTok", "Snapchat", "LinkedIn", "LINE", "KakaoTalk", "Twitter", "VKontakte", "WeChat", "WhatsApp", "YouTube"
9. Status relacji to "Single", "In Relationship", "Complicated"
10. Wynik wpływu na wyniki akademickie to "Yes" lub "No"
11. Wynik konfliktu z social mediami to "0", "1", "2", "3", "4", "5"

```{r}
library(validate)

table(dane$Most_Used_Platform)
table(dane$Relationship_Status)
table(dane$Academic_Level)

rules <- validator(
  Age >= 16 & Age <= 100,
  Avg_Daily_Usage_Hours >= 0 & Avg_Daily_Usage_Hours <= 24,
  Sleep_Hours_Per_Night >= 0 & Sleep_Hours_Per_Night <= 24,
  Mental_Health_Score >= 0 & Mental_Health_Score <= 10,
  Addicted_Score >= 0 & Addicted_Score <= 10,
  Gender %in% c("Male", "Female", "Other"),
  Academic_Level %in% c("Undergraduate", "Graduate", "High School"),
  Most_Used_Platform %in% c("Instagram", "Facebook", "TikTok", "Snapchat", "LinkedIn", "LINE", "KakaoTalk", "Twitter", "VKontakte", "WeChat", "WhatsApp", "YouTube"),
  Relationship_Status %in% c("Single", "In Relationship", "Complicated"),
  Affects_Academic_Performance %in% c("Yes", "No"),
  Conflicts_Over_Social_Media %in% c("0", "1", "2", "3", "4", "5")
)

```

Czy zbiór danych spełnia te reguły? 
Upewniamy się za pomocą funkcji confront

```{r}
cf <- confront(dane, rules, key="Student_ID")
summary(cf)
plot(cf, main="dane")

```

W naszym zbiorze danych nie ma żadnego konfliktu; 100% reguł jest spełnione, teraz sprawdzamy kompletność danych z pakietem vis_miss   

```{r}
vis_miss(dane) 
vis_miss(dane, cluster = TRUE) #Wizualizujemy z grupowaniem kolumn i wierszy o podobnym wzorcu braków
n_miss(dane) #Sprawdzamy liczbę braków w całym zbiorze
prop_miss(dane) #Sprawdzamy procent braków w całym zbiorze
miss_var_summary(dane)
```
Dane są kompletne – brak wartości brakujących (NA) w żadnej kolumnie. 
Możemy przejść do wizualizacji danych.

# 3. Wizualizacja danych 

Celem naszego projektu jest zbadanie uzależnienia od korzystania z mediów 
społecznościowych wśród studentów. Postanowiliśmy zbadać korelację czasu spędzanego 
w social mediach ze średnim czasem snu, czy uzależnienie od mediów społecznościowych zależy 
od poziomu wykształcenia oraz sprawdzić jak wygląda uzależnienie od mediów społecznościowych 
w zależności od krajów. 

3.1 Sprawdzamy jaki jest średni czas snu w zależności od średniego czasu spędzanego na platformach social media? 

```{r}
#4. Jaki jest średni czas snu w zależności od średniego czasu spędzanego na platformach social media i czy wpływa to na wynik akademicki? 

#wykres kropkowy z linią trendu 
  
library(ggplot2)
dane <- read.csv("data/Students_Social_Media_Addiction.csv")
ggplot(dane, aes(x = Sleep_Hours_Per_Night, y = Avg_Daily_Usage_Hours, color = Affects_Academic_Performance)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +                   
  labs(
    title = "Średni czas korzystania z mediów społecznościowych a średni czas snu",
    y = "Średni czas snu", 
    x = "Średni czas spędzony w mediach społecznościowych")

#wykres boxplotowy z podziałem na kategorie wg sredniej czasu spedzanego na social mediach 

dane$Avg_Daily_Usage_Hours <- as.numeric(dane$Avg_Daily_Usage_Hours)
dane$social_media_avg <- cut(dane$Avg_Daily_Usage_Hours, breaks = c(0,2,4,6,8,10, Inf), labels = c("0-2", "2-4", "4-6", "6-8", "8-10", "wiecej niz 10"))
ggplot(dane, aes(y = Sleep_Hours_Per_Night, x = social_media_avg)) + 
  geom_boxplot() +                   
  labs(
    title = "Średni czas korzystania z mediów społecznościowych a średni czas snu",
    y = "średni czas snu", 
    x = "średni czas spędzany w mediach społecznościowych")
```

Średnia czasu spędzanego na platforach social media jest odwrotnie proporcjonalna do średniego czasu snu. 
Na podstawie pierwszego wykresu można zauważyć, że osoby, na których wyniki akademickie wpływa czas spędzony na social mediach śpią średnio krócej i spędzają więcej czasu na platformach społecznościowych. 

Na podstawie drugiego wykresu można zauważyć ujemną korelację średniej czasu snu ze średnią czasu spędzonego w social mediach. 

3.2 Sprawdzamy czy poziom wykształcenia wpływa na intensywność używania mediów społecznościowych?

```{r}
#6. Czy poziom wykształcenia wpływa na intensywność używania mediów społecznościowych?

ggplot(dane, aes( y = social_media_avg, fill = Academic_Level)) +
geom_bar()  +                   
  labs(
    title = "Średni czas korzystania z mediów społecznościowych według wykształcenia",
    y = "Średni dzienne użycie mediów (godz.)", 
    x = "liczba obserwacji"
  )  +
  labs(title = "Średni czas korzystania z mediów społecznościowych według wykształcenia",
      fill = "Poziom wykształcenia") +
  theme(
    plot.title = element_text(size = 16, face = "bold"),
    legend.title = element_text(size = 10),
    legend.text = element_text(size = 10)
  )

```
Na podstawie powyższego wykresu można stwierdzić, że średni czas korzystania z mediów społecznościowych zależy w nieznaczym stopniu od wykształcenia. Wśród grupy, która spędza od 0 do 2 godzin w social media są jedynie absolwenci szkół wyższych a wśród grupy, która spędza od 8 do 10 godzin dziennie na platformach social media są wyłącznie osoby, które nie ukończyły jeszcze studiów. Osoby z wykształceniem średnim najczęściej spędzają od 4 do 6 godzin dziennie w mediach społecznościowych. 

3.3 Sprawdzamy jaki jest średni czas spędzany w social mediach w zależności od narodowości?

```{r}
#8. Jaki jest średni czas spędzany w social mediach w zależności od narodowości?

library(maps)
world <- map_data("world") 
avg_by_country <- dane %>%
  group_by(Country) %>%
  summarise(mean_hours = mean(Avg_Daily_Usage_Hours, na.rm = TRUE))
world_data <- left_join(world, avg_by_country, by = c("region" = "Country"))
head(avg_by_country)
ggplot(world_data, aes(x = long, y = lat, group = group, fill = mean_hours)) +
  geom_polygon(color = "black") +
  scale_fill_viridis_c(option = "plasma", na.value = "grey90") +
  labs(title = "Średni czas spędzany w social mediach według narodowości",
       fill = "liczba godzin 
spędzanych
w social mediach") +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold"),
    legend.title = element_text(size = 10),
    legend.text = element_text(size = 10)
  )

```

3.4 Sprawdzamy czy zdrowie psychiczne zależy od czasu spędzonego w mediach społecznościowych 

```{r}
ggplot(dane, aes(x = social_media_avg, y = Mental_Health_Score)) +
  geom_boxplot()  +
  labs(
    title = "Zależność między czasem w mediach społecznościowych a zdrowiem psychicznym",
    x = "Czas w mediach społecznościowych",
    y = "Zdrowie psychiczne (0–10)"
  )

```
Na podstawie powyższego wykresu można stwierdzić, że istnieje negatywna korelacja między czasem spędzonym w mediach społecznościowych a zdrowiem psychicznym, przy czym najlepszy wynik zdrowia psychicznego wydaje się być w przedziale "0–2" godziny. Wzrost czasu spędzanego na platformach społecznościowych (z 2 do 8 godzin) wiąże się ze stopniowym pogorszeniem zdrowia psychicznego.Wykres sugeruje, że umiarkowane lub wysokie wykorzystanie mediów społecznościowych (od 2 do 8 godzin) jest związane zarówno z gorszym średnim zdrowiem psychicznym, jak i większą niepewnością wyników w tej grupie.

# 4. Statystyki opisowe

4.1 Sprawdzamy czy poziom wykształcenia wpływa na intensywność używania mediów społecznościowych

```{r kable_report_clean, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
library(dplyr)
library(psych)
library(kableExtra)
library(knitr)
library(tibble)

#Oblcizanie statystyk opisowych: Średni czas korzystania z mediów społecznościowych wg poziomu edukacji
statystyki <- dane %>%
  group_by(Academic_Level) %>%
  summarise(
    Min = min(Avg_Daily_Usage_Hours, na.rm = TRUE),
    Max = max(Avg_Daily_Usage_Hours, na.rm = TRUE),
    "Kwartyl dolny" = quantile(Avg_Daily_Usage_Hours, 0.25, na.rm = TRUE),
    Mediana = median(Avg_Daily_Usage_Hours, na.rm = TRUE),
    "Kwartyl górny" = quantile(Avg_Daily_Usage_Hours, 0.75, na.rm = TRUE),
    "Średnia" = mean(Avg_Daily_Usage_Hours, na.rm = TRUE),
    "Odch. std." = sd(Avg_Daily_Usage_Hours, na.rm = TRUE),
    IQR = IQR(Avg_Daily_Usage_Hours, na.rm = TRUE),
    "Odchylenie ćwiartkowe" = IQR(Avg_Daily_Usage_Hours, na.rm = TRUE)/2,
    "Odch. std. w %" = (sd(Avg_Daily_Usage_Hours, na.rm = TRUE)/mean(Avg_Daily_Usage_Hours, na.rm = TRUE))*100,
    "Odch. ćwiartkowe w %" = (IQR(Avg_Daily_Usage_Hours, na.rm = TRUE)/median(Avg_Daily_Usage_Hours, na.rm = TRUE))*100,
    "Skośność" = skew(Avg_Daily_Usage_Hours, na.rm = TRUE),
    Kurtoza = kurtosi(Avg_Daily_Usage_Hours, na.rm = TRUE)
  )

#Transpozycja (Obracamy tabelę, żeby statystyki były w wierszach)
# Zapisujemy nazwy grup
nazwy_kolumn <- statystyki$Academic_Level

#Obracamy samą część liczbową (bez pierwszej kolumny z nazwami grup)
tabela_final <- t(statystyki[, -1])

#Przypisujemy nazwy kolumnom (High School, Undergraduate, Graduate)
colnames(tabela_final) <- nazwy_kolumn

tabela_final %>%
  as.data.frame() %>%
  rownames_to_column("Statystyka") %>%
  # Nakładam nowe nazwy na kolumny w kolejności od lewej do prawej, bo bez tego się mieszało (nazwy były w kolejności alfabetycznej)
  setNames(c("Statystyka", "High School", "Undergraduate", "Graduate")) %>%
  kbl(
    caption = "Tabela 1. Średni czas korzystania z mediów społecznościowych wg poziomu edukacji.",
    digits = 2,
    align = "c"
  ) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive", "bordered"),
    full_width = FALSE,
    position = "center",
    font_size = 14
  ) %>%
  add_header_above(c(" " = 1, "Poziom Edukacji" = 3), bold = TRUE, background = "#F2F2F2") %>%
  row_spec(0, bold = TRUE, color = "white", background = "blue") %>%
  column_spec(1, bold = TRUE, border_right = TRUE, width = "5cm") 
```

Na podstawie danych z tabeli można zauważyć, że poziom wykształcenia różnicuje intensywność korzystania z mediów społecznościowych. Najwyższy poziom aktywności wykazuje grupa Undergraduate, osiągając najwyższą średnią (5.54) oraz medianę (5.60). Osoby z wykształceniem High School korzystają z mediów najmniej intensywnie (średnia 4.78), natomiast grupa Graduate plasuje się pośrodku ze średnią 5.00. Wyniki sugerują więc, że etap studiów licencjackich sprzyja najczęstszemu korzystaniu z mediów społecznościowych w porównaniu do osób przed studiami lub z wyższym stopniem naukowym.

4.2 Sprawdzamy: Czy status związku ma wpływ na ilość przespanych godzin w nocy?

```{r}
library(kableExtra)
library(dplyr)

dane %>%
  mutate(Relationship_Status = recode(Relationship_Status, 
                                      "Single" = "Singiel",
                                      "In Relationship" = "W związku", 
                                      "Complicated" = "To skomplikowane")) %>%
  group_by(Relationship_Status) %>%
  summarize(
    Min = min(Sleep_Hours_Per_Night),
    Max = max(Sleep_Hours_Per_Night),
    Średnia = mean(Sleep_Hours_Per_Night), 
    Odchylenie = sd(Sleep_Hours_Per_Night),
    Mediana = median(Sleep_Hours_Per_Night),
    Q1 = quantile(Sleep_Hours_Per_Night, 0.25),
    Q3 = quantile(Sleep_Hours_Per_Night, 0.75),
    Skośność = skew(Sleep_Hours_Per_Night),
    Kurtoza = kurtosi(Sleep_Hours_Per_Night)
  ) %>%
  mutate(Średnia = cell_spec(round(Średnia, 2), 
                        color = ifelse(Średnia < 6.0, "red", "green"),
                        bold = ifelse(Średnia < 6.0, TRUE, FALSE))
  ) %>%
  select(Relationship_Status, Min, Max, Średnia, Odchylenie, Mediana, Q1, Q3, Skośność, Kurtoza) %>%
  kbl(digits = 2, escape = F,
      col.names = c("Status związku", "Min", "Max", "Średnia", "Odch. std", 
                    "Mediana", "Q1", "Q3", "Skośność", "Kurtoza")) %>%
  
  kable_styling(bootstrap_options = c("bordered", "hover"), 
                full_width = F, 
                html_font = "Cambria") %>%
  add_header_above(c(" " = 1, 
                     "Zakres danych" = 2, 
                     "Miary tendencji centralnej" = 3, 
                     "Kwantyle" = 2, 
                     "Kształt rozkładu" = 2), 
                   bold = T, color = "black") %>%
  
  row_spec(0, bold = T, color = "white", background = "blue")
``` 

Najgorzej wypada grupa o statusie „To skomplikowane”, gdzie średnia długość snu wynosi zaledwie 5,9 godziny, co jest wynikiem znacznie niższym niż w pozostałych kategoriach. Osoby te nie tylko śpią najkrócej, ale też żadna z nich nie przekroczyła 7,4 godziny snu. „Single” śpią średnio najdłużej (6,98 h), wyprzedzając nieznacznie osoby „W związku” (6,83 h). Warto jednak zauważyć, że choć osoby w związku mają nieco niższą średnią, to ich mediana wynosi 7,0, co oznacza, że typowy przedstawiciel tej grupy śpi optymalną ilość czasu.Różnica między niepewną relacją a stabilnymi statusami jest więc wyraźna i sugeruje, że brak stabilizacji może negatywnie wpływać na regenerację. Podsumowując, osoby w ustabilizowanej sytuacji (singiel lub związek) śpią o około godzinę dłużej niż te w skomplikowanych relacjach. 

4.3 Macierz korelacji

```{r setup, include=FALSE}
download.file("https://github.com/murdzakarolina/Projekt-zespolowyPG-Analiza-Danych-w-R/blob/main/data/Students_Social_Media_Addiction.csv?raw=true", destfile = "dane5.csv", mode="wb")
dane5 <- read.csv("dane5.csv", sep=",", dec=".")


library(corrplot)

```

```{r bivariate, echo=FALSE, warning=TRUE}
corrplot(cor(dane5[, c(2, 6, 9, 10, 12, 13)]), method = "number", type = "upper", diag =FALSE)

M <- cor(dane5[, c(2, 6, 9, 10, 12, 13)])

corrplot.mixed(M, order = 'AOE', upper = "circle", lower = "number", tl.col = "black", tl.pos = "lt", number.cex = 0.7)
```
Najsilniejsza zależność widoczna jest w negatywnym wpływie mediów społecznościowych na zdrowie psychiczne – im wyższy wskaźnik uzależnienia oraz częstsze konflikty na tym tle, tym drastycznie niższy wynik zdrowia psychicznego. Istnieje wyraźna korelacja ujemna (-0.79) między czasem spędzanym w social mediach a długością snu, co oznacza, że intensywne korzystanie z sieci odbywa się kosztem nocnego wypoczynku. Długość snu ma silny, pozytywny wpływ na kondycję psychiczną (współczynnik 0.71), a to sugeruje, że dbanie o sen jest ważne dla dobrostanu psychicznego w kontekście cyfrowym. Wskaźniki problematycznego korzystania z sieci są ze sobą ściśle powiązane: wysoki poziom uzależnienia bardzo mocno koreluje z występowaniem konfliktów z powodu social mediów (0.93) oraz z czasem ich użytkowania (0.83). Zmienna wieku nie wykazuje istotnych powiązań z pozostałymi czynnikami (bardzo słabe korelacje, np. 0.13 czy -0.11), co sugeruje, że opisane problemy dotykają badanych niezależnie od tego, ile mają lat.
